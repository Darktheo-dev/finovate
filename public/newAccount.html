<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="create_account.css" />
  </head>
  <body
    class="d-flex flex-column align-items-center justify-content-center vh-100 bg-light"
  >
    <h1 id="title" class="text-center fw-bold">Enter Information</h1>

    <form
      id="registerForm"
      class="row g-3 needs-validation"
      action="#"
      method="POST"
      novalidate
    >
      <div class="col-md-6">
        <label for="firstName" class="form-label">First name</label>
        <input
          type="text"
          class="form-control"
          id="firstName"
          name="firstName"
          required
        />
        <div class="invalid-feedback">Please enter your first name.</div>
      </div>

      <div class="col-md-6">
        <label for="lastName" class="form-label">Last name</label>
        <input
          type="text"
          class="form-control"
          id="lastName"
          name="lastName"
          required
        />
        <div class="invalid-feedback">Please enter your last name.</div>
      </div>

      <div class="col-md-6">
        <label for="dob" class="form-label">Date of Birth</label>
        <input
          type="date"
          class="form-control"
          id="dob"
          name="dob"
          required
        />
        <div class="invalid-feedback">Please enter your date of birth.</div>
      </div>

      <div class="col-md-6">
        <label for="email" class="form-label">Email</label>
        <input
          type="email"
          class="form-control"
          id="email"
          name="email"
          required
        />
        <div class="invalid-feedback">Please enter a valid email.</div>
      </div>

      <div class="col-md-6">
        <label for="username" class="form-label">Username</label>
        <input
          type="text"
          class="form-control"
          id="username"
          name="username"
          required
        />
        <div class="invalid-feedback">Please enter a username.</div>
      </div>

      <div class="col-md-6">
        <label for="password" class="form-label">Password</label>
        <input
          type="password"
          class="form-control"
          id="password"
          name="password"
          required
        />
        <div class="invalid-feedback">Please enter a password.</div>
      </div>

      <div class="col-12">
        <button id="Submit" type="submit" class="btn btn-primary w-100">
          Enter
        </button>
      </div>
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("registerForm");

        form.addEventListener("submit", function (event) {
          event.preventDefault();

          if (!form.checkValidity()) {
            event.stopPropagation();
            form.classList.add("was-validated");
            return;
          }

          // Collect form data
          const formData = new URLSearchParams();
          formData.append("firstName", document.getElementById("firstName").value.trim());
          formData.append("lastName", document.getElementById("lastName").value.trim());
          formData.append("dob", document.getElementById("dob").value.trim());
          formData.append("email", document.getElementById("email").value.trim());
          formData.append("username", document.getElementById("username").value.trim());
          formData.append("password", document.getElementById("password").value.trim());

          // Send POST request to backend
          fetch("/newAccount", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded"
            },
            body: formData.toString()
          })
            .then(response => response.text())
            .then(result => {
              if (result.includes("success")) {
                alert("✅ Account created successfully!");
                window.location.href = "index.html"; // Redirect to login
              } else {
                alert("❌ " + result);
              }
            })
            .catch(error => {
              console.error("Error:", error);
              alert("⚠️ Something went wrong.");
            });

          form.classList.add("was-validated");
        });
      });
    </script>
  </body>
</html>